@using Microsoft.AspNetCore.Mvc.TagHelpers
@using IntelliTest.Core.Contracts
@using IntelliTest.Data.Enums
@using IntelliTest.Infrastructure
@model QueryModel<LessonViewModel>
@{
    ViewBag.Title = "Уроци";
    int maxPage = (int)Math.Ceiling((double)Model.TotalItemsCount /
                                    Model.ItemsPerPage);
    int paginationStart = Model.CurrentPage - (int)Math.Max(0, Math.Min(2, maxPage-1) - maxPage + Model.CurrentPage);
}

<div class="container" style="margin-top: 30px; margin-bottom: 0px">
    <div class="row">
        <h2 style="text-align: center;" id="lessonHeading">Уроци</h2>
        <div class="floating-container">
            <a class="floating-button" asp-action="Create">+</a>
        </div>
        <div class="col-lg-12 mb-3">
            <partial name="Filters" model="Model.Filters"/>
            @if (Model.Items.Count() != 0)
            {
                <div class="questBoxHover questBox card py-3 px-3 mb-3 border-top-0 border-bottom-0" style="width: 100%">
                    @foreach (var lesson in Model.Items)
                    {
                        <partial name="~/Views/Lessons/LessonPartialView.cshtml" model="lesson"/>
                    }
                </div>
            }
            else
            {
                <h2 style="text-align: center">Няма резултати...</h2>
            }
            <nav aria-label="Page navigation example" style="position: absolute; bottom: 20px; width: 100%">
                <ul class="pagination justify-content-center" style="font-size: 1.5rem">
                    <li class="page-item disabled">
                        <a class="page-link @(Model.CurrentPage == 1 ? "disabled" : string.Empty)"
                           asp-action="Index"
                           asp-route-currentPage="@(Model.CurrentPage - 1)"
                           asp-route-Subject="@Model.Filters.Subject"
                           asp-route-Grade="@Model.Filters.Grade"
                           asp-route-SearchTerm="@Model.Filters.SearchTerm"
                           asp-route-Sorting="@(Model.Filters.Sorting)">Previous</a>
                    </li>
                    @for (int i = paginationStart; i <= maxPage && i - paginationStart <= 3; i++)
                    {
                        <li class="page-item">
                            <a class="page-link @(Model.CurrentPage == i ? "disabled" : string.Empty)"
                               asp-action="Index"
                               asp-route-currentPage="@i"
                               asp-route-Subject="@Model.Filters.Subject"
                               asp-route-Grade="@Model.Filters.Grade"
                               asp-route-SearchTerm="@Model.Filters.SearchTerm"
                               asp-route-Sorting="@(Model.Filters.Sorting)">@i</a>
                        </li>
                    }
                    <li class="page-item disabled">
                        <a class="page-link @(Model.CurrentPage == maxPage ? "disabled" : string.Empty)"
                           asp-action="Index"
                           asp-route-currentPage="@(Model.CurrentPage + 1)"
                           asp-route-Subject="@Model.Filters.Subject"
                           asp-route-Grade="@Model.Filters.Grade"
                           asp-route-SearchTerm="@Model.Filters.SearchTerm"
                           asp-route-Sorting="@(Model.Filters.Sorting)">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>
<script>
    var root = document.querySelector(":root");

    root.style.fontSize = "16px";
    function onLike(e){
        if (e.style.backgroundPositionX === "-2800px"){
            $.ajax({
              type: 'get',
              url: `/Lessons/Unlike?lessonId=${e.id}&userId=@User.Id()`
            });
            e.parentNode.children[1].textContent = parseInt(e.parentNode.children[1].textContent.replace(" Likes", ""))-1 + " Likes";
            e.style.transitionDuration = "0s";
            e.style.backgroundPosition = '0 0';
        }
        else{
            $.ajax({
              type: 'get',
              url: `/Lessons/Like?lessonId=${e.id}&userId=@User.Id()`
            });
            e.parentNode.children[1].textContent = parseInt(e.parentNode.children[1].textContent.replace(" Likes", ""))+1 + " Likes";
            e.style.transitionDuration = "1s";
            e.style.backgroundPosition = '-2800px 0';
        }
    }
    OnTrigger();
    $("#main").css("margin-bottom", "0px");
</script>